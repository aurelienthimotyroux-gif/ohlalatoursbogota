<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ _("Nos tours") }} â€” Oh La La Tours BogotÃ¡</title>

  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

  <style>
    .tour-card { display: flex; align-items: stretch; gap: 20px; margin: 40px 0; }
    .tour-card.left  { flex-direction: row; }
    .tour-card.right { flex-direction: row-reverse; }

    /* Swiper */
    .tour-swiper { width: 50%; height: 350px; border-radius: 10px; overflow: hidden; position: relative; z-index: 2; touch-action: pan-y; }
    .tour-swiper .swiper-wrapper{ height: 100%; }
    .tour-swiper .swiper-slide{ width: 100% !important; display: flex; }
    .tour-swiper img { width: 100%; height: 100%; object-fit: cover; display: block; }

    .tour-swiper .swiper-button-next,
    .tour-swiper .swiper-button-prev { z-index: 5; pointer-events: auto; color: #fff !important; text-shadow: 0 0 6px rgba(0,0,0,.65); }
    .tour-swiper .swiper-button-next::after,
    .tour-swiper .swiper-button-prev::after { font-size: 24px; }

    /* Contenu cartes tours */
    .tour-card .content { width: 50%; padding: 15px; border-radius: 10px; max-width: 680px; }
    .tour-card h3.tour-title { font-size: clamp(26px, 3.2vw, 36px); line-height: 1.15; margin: 0 0 10px; letter-spacing: .2px; }
    .tour-lead { font-size: clamp(16px, 1.8vw, 18px); line-height: 1.7; color: rgba(0,0,0,.78); margin: 10px 0 16px; max-width: 62ch; }

    /* Bloc "Inclus" */
    .tour-includes { position: relative; margin: 14px 0 12px; padding-left: 14px; flex-basis:100%; order:3; }
    .tour-includes::before { content: ""; position: absolute; left: 0; top: 4px; bottom: 4px; width: 4px; border-radius: 4px; background: linear-gradient(180deg, #f59e0b, #f97316); }
    .includes-title { margin: 0 0 8px; font-size: 14px; letter-spacing: .4px; text-transform: uppercase; opacity: .8; }
    .includes-list { list-style: none; margin: 0; padding: 0; display: grid; gap: 8px 14px; grid-template-columns: 1fr; }
    .includes-list li { position: relative; padding-left: 26px; line-height: 1.6; }
    .includes-list li::before { content: "âœ“"; position: absolute; left: 0; top: 0; font-weight: 700; transform: translateY(1px); opacity: .9; }
    @media (min-width: 900px) { .includes-list { grid-template-columns: 1fr 1fr; } }

    /* Chips infos */
    .tour-chips { list-style: none; padding: 0; margin: 0; display: flex; flex-wrap: wrap; gap: 16px; }
    .tour-chips .chip { background: none !important; border: none !important; padding: 0 !important; border-radius: 0 !important; box-shadow: none !important; font-size: 16px; line-height: 1.6; }
    .tour-chips .chip strong { font-weight: 700; }

    /* CTA */
    .tour-meta{ flex-basis:100%; order:4; display:flex; align-items:center; gap:18px; flex-wrap:wrap; margin-top:8px; }

    /* Bouton */
    .btn-primary { border: 1px solid rgba(0,0,0,.2); background: #2563eb; color: #fff; padding: 12px 18px; border-radius: 12px; font-weight: 700; cursor: pointer; }
    .btn-primary:hover { filter: brightness(1.05); }
    .btn-primary:active { transform: translateY(1px); }

    /* Responsive */
    @media (max-width: 900px){
      .tour-card{ flex-direction: column !important; }
      .tour-swiper, .tour-card .content{ width: 100%; }
      .tour-meta{ flex-direction: column; align-items: flex-start; gap: 10px; }
    }

    /* Fix overlays bloquants */
    .hero::after { pointer-events: none; }
    [class*="gradient"], [class*="overlay"], [class*="mask"] { pointer-events: none; }
  </style>
</head>
<body>

<header class="hero background-half"
        style="background-image: url('{{ url_for('static', filename='images/header_tours.jpg') }}');">
  <div class="hero-topbar">
      <div id="lang-switcher" aria-label="{{ _('Choix de la langue') }}">
          <a href="{{ lang_url('fr') }}">ðŸ‡«ðŸ‡·</a> |
          <a href="{{ lang_url('en') }}">ðŸ‡ºðŸ‡¸</a> |
          <a href="{{ lang_url('es') }}">ðŸ‡ªðŸ‡¸</a>
      </div>
      <nav class="nav-hero" aria-label="{{ _('Navigation principale') }}">
          <a href="{{ url_for('index', lang=get_locale()) }}">{{ _("Accueil") }}</a> |
          <a href="{{ url_for('tours', lang=get_locale()) }}">{{ _("Nos tours") }}</a> |
          <a href="{{ url_for('transport', lang=get_locale()) }}">{{ _("Service de Transport") }}</a> |
          <a href="{{ url_for('reservation', lang=get_locale()) }}">{{ _("RÃ©servation") }}</a>
      </nav>
  </div>
  <h1 class="hero-title">{{ _("Nos tours") }}</h1>
</header>

<main>
  <section id="excursions">

  {# boucle sur tes tours inchangÃ©e, je montre juste la structure du carrousel #}
  {% for tour in tours_data %}
  <div class="tour-card {% if loop.index is odd %}left{% else %}right{% endif %}">
    <div class="swiper tour-swiper" aria-label="{{ _('Galerie dâ€™images du tour') }} {{ tour.title }}">
      <div class="swiper-wrapper">
        {% for img in tour.images %}
        <div class="swiper-slide">
          <img src="{{ url_for('static', filename='images/' ~ img) }}" alt="{{ tour.title }} {{ ALT.get(img) or alt_map.get(img, '') }}">
        </div>
        {% endfor %}
      </div>
      <!-- FlÃ¨ches + pagination dans le carrousel -->
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-pagination"></div>
    </div>

    <div class="content">
      <h3 class="tour-title">{{ tour.title }}</h3>
      <p class="tour-lead">{{ tour.desc }}</p>
    </div>

    {% if tour.includes is defined and tour.includes %}
    <div class="tour-includes">
      <h4 class="includes-title">{{ _("Ce qui est inclus :") }}</h4>
      <ul class="includes-list">
        {% for item in tour.includes %}
        <li>{{ item }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <div class="tour-meta">
      <ul class="tour-chips" aria-label="{{ _('Informations pratiques') }}">
        {% for info in tour.infos %}
          {% set parts = info.split(':') %}
          <li class="chip">
            <strong>{{ parts[0] }}:</strong>&nbsp;{{ parts[1] if parts|length > 1 else '' }}
          </li>
        {% endfor %}
      </ul>
      <a href="{{ url_for('reservation', tour=tour.slug, lang=get_locale()) }}">
        <button class="btn-primary">{{ _("RÃ©server") }}</button>
      </a>
    </div>
  </div>
  {% endfor %}
  </section>
</main>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
(function(){
  function initTourSwipers(){
    document.querySelectorAll('.tour-swiper').forEach(function(slider){
      if (slider.dataset.initialized === "1") return;  // anti double-init
      slider.dataset.initialized = "1";

      var nextBtn = slider.querySelector('.swiper-button-next');
      var prevBtn = slider.querySelector('.swiper-button-prev');
      var pag     = slider.querySelector('.swiper-pagination');

      new Swiper(slider, {
        slidesPerView: 1,
        spaceBetween: 0,
        effect: 'slide',
        speed: 700,
        loop: true,
        loopAdditionalSlides: 1,
        watchOverflow: true,
        preloadImages: true,
        lazy: { loadPrevNext: true },
        autoplay: { delay: 3500, disableOnInteraction: false, pauseOnMouseEnter: true },
        observer: true,
        observeParents: true,
        observeSlideChildren: true,
        simulateTouch: true,
        grabCursor: true,
        keyboard: { enabled: true, onlyInViewport: true },
        navigation: { nextEl: nextBtn, prevEl: prevBtn },
        pagination: { el: pag, clickable: true }
      });
    });
  }

  if (document.readyState === "loading") {
    document.addEventListener('DOMContentLoaded', initTourSwipers);
    window.addEventListener('load', initTourSwipers);
  } else {
    initTourSwipers();
  }
})();
</script>

</body>
</html>

