<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
  <meta charset="UTF-8" />
  <title>{{ _("R√©server votre visite") }} ‚Äî Oh La La Tours Bogot√°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ‚úÖ Meta SEO -->
  <meta name="description" content="{{ _('R√©servez votre visite guid√©e √† Bogot√° : Candelaria, Monserrate, Zipaquir√°, La Chorrera et finca caf√©. Guide francophone/anglais/espagnol. Paiement PayPal s√©curis√©.') }}">
  <meta name="keywords" content="r√©servation tour Bogot√°, r√©server visite guid√©e Bogot√°, tours priv√©s Bogot√°, Candelaria, Monserrate, Zipaquir√°, La Chorrera, Hacienda Coloma, guide francophone Bogot√°, paiement PayPal Bogot√°">

  <!-- ‚úÖ CMP / consentmanager (doit √™tre avant GA) -->
  <script type="text/javascript" data-cmp-ab="1"
          src="https://cdn.consentmanager.net/delivery/autoblocking/62cc8437f29ac.js"
          data-cmp-host="b.delivery.consentmanager.net"
          data-cmp-cdn="cdn.consentmanager.net"
          data-cmp-codesrc="16"></script>

  <!-- ‚úÖ Google Consent Mode (valeurs par d√©faut = refus, optionnel mais recommand√©) -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('consent', 'default', {
      ad_storage: 'denied',
      analytics_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      wait_for_update: 500
    });
  </script>

  <!-- ‚úÖ Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-92M6CENDXH"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    // Id de mesure GA4
    gtag('config', 'G-92M6CENDXH', {
      anonymize_ip: true  // optionnel mais recommand√©
    });
  </script>

  <!-- ‚úÖ Texte masqu√© accessible -->
  <style>
    .sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,1px,1px);white-space:nowrap;border:0}
  </style>

  <!-- ‚úÖ Styles AJOUT√âS pour le header fixe + logo -->
  <style>
    .site-header{
      position:fixed; top:0; left:0; right:0; z-index:70;
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 16px; gap:16px;
      background:transparent; transition:background .25s ease, box-shadow .25s ease;
    }
    .brand{display:inline-flex; align-items:center; gap:10px}
    .logo{height:44px; width:auto; display:block}
    @media (max-width:640px){ .logo{height:32px} }

    .main-nav{display:flex; align-items:center; gap:18px; font-weight:600}
    .main-nav a{text-decoration:none}
    .lang-switcher{display:flex; gap:8px; margin-left:8px}
    .lang-switcher a{font-size:20px; line-height:1; padding:4px 6px; border-radius:6px}

    /* Sur cette page (hero en fond) : liens & logo blancs au d√©part */
    .header-on-hero .main-nav a{color:#fff; text-shadow:0 1px 2px rgba(0,0,0,.35)}
    .logo--dark{display:none}

    /* Au scroll / fond clair */
    .site-header.scrolled{
      background: rgba(255,255,255,.86);
      backdrop-filter: saturate(180%) blur(8px);
      box-shadow: 0 2px 10px rgba(0,0,0,.08);
    }
    .site-header.scrolled .logo--light{display:none}
    .site-header.scrolled .logo--dark{display:block}
    .site-header.scrolled .main-nav a{color:#0f172a}
  </style>

<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/favicon/apple-touch-icon.png') }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon/favicon-32x32.png') }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon/favicon-16x16.png') }}">
<link rel="manifest" href="{{ url_for('static', filename='img/favicon/site.webmanifest') }}">
<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon/favicon.ico') }}">
<meta name="theme-color" content="#0b4654">

<link rel="icon" href="/favicon.ico" sizes="any">

</head>

  <!-- ‚úÖ Canonical + hreflang -->
  <link rel="canonical" href="https://www.ohlalatoursbogota.com{{ request.path }}{% if get_locale()!='fr' %}?lang={{ get_locale() }}{% endif %}">
  <link rel="alternate" href="{{ url_for('reservation', lang='fr', _external=True) }}" hreflang="fr">
  <link rel="alternate" href="{{ url_for('reservation', lang='en', _external=True) }}" hreflang="en">
  <link rel="alternate" href="{{ url_for('reservation', lang='es', _external=True) }}" hreflang="es">
  <link rel="alternate" href="{{ url_for('reservation', lang='fr', _external=True) }}" hreflang="x-default">

  <!-- ‚úÖ Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.ohlalatoursbogota.com{{ request.path }}{% if get_locale()!='fr' %}?lang={{ get_locale() }}{% endif %}">
  <meta property="og:site_name" content="Oh La La Tours Bogot√°">
  <meta property="og:title" content="{{ _('R√©server votre visite ‚Äì Oh La La Tours Bogot√°') }}">
  <meta property="og:description" content="{{ _('R√©servez une visite guid√©e : Candelaria, Monserrate, Zipaquir√°, La Chorrera ou finca caf√©. Paiement PayPal, guide francophone/anglais/espagnol.') }}">
  <meta property="og:image" content="{{ url_for('static', filename='images/bg_reservation.jpg', _external=True) }}">
  <!-- ‚úÖ ALT OG ajout√© -->
  <meta property="og:image:alt" content="{{ _('Panorama de Bogot√°, t√©l√©ph√©rique de Monserrate et rues coloniales de la Candelaria ; page de r√©servation pour visites priv√©es et transferts. EN: Bogot√° skyline and Monserrate cable car; private tours booking & airport transfer. ES: Bogot√° al atardecer y telef√©rico de Monserrate; reserva de tours privados y traslado al aeropuerto') }}">
  {% if get_locale() == 'fr' %}
  <meta property="og:locale" content="fr_FR">
  {% elif get_locale() == 'en' %}
  <meta property="og:locale" content="en_US">
  {% else %}
  <meta property="og:locale" content="es_CO">
  {% endif %}

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ _('R√©server votre visite ‚Äì Oh La La Tours Bogot√°') }}">
  <meta name="twitter:description" content="{{ _('R√©servez une visite guid√©e : Candelaria, Monserrate, Zipaquir√°, La Chorrera ou finca caf√©. Paiement PayPal, guide francophone/anglais/espagnol.') }}">
  <meta name="twitter:image" content="{{ url_for('static', filename='images/bg_reservation.jpg', _external=True) }}">
  <!-- ‚úÖ ALT Twitter ajout√© -->
  <meta name="twitter:image:alt" content="{{ _('Panorama de Bogot√°, t√©l√©ph√©rique de Monserrate et rues coloniales de la Candelaria ; page de r√©servation pour visites priv√©es et transferts. EN: Bogot√° skyline and Monserrate cable car; private tours booking & airport transfer. ES: Bogot√° al atardecer y telef√©rico de Monserrate; reserva de tours privados y traslado al aeropuerto') }}">

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

  <!-- ‚úÖ Nouveau header fixe (logo + nav + drapeaux) -->
  <header class="site-header header-on-hero">
    <a href="{{ url_for('index', lang=get_locale()) }}" class="brand" aria-label="Oh La La Tours Bogot√° ‚Äî Accueil">
      <!-- logo blanc sur la photo -->
      <img class="logo logo--light"
           src="{{ url_for('static', filename='img/logo/logo-ohlala-white-360.png') }}"
           srcset="{{ url_for('static', filename='img/logo/logo-ohlala-white-720@2x.png') }} 2x"
           alt="Oh La La Tours Bogot√°">
      <!-- logo couleur au scroll / fonds clairs -->
      <img class="logo logo--dark"
           src="{{ url_for('static', filename='img/logo/logo-ohlala-teal-gold-360.png') }}"
           srcset="{{ url_for('static', filename='img/logo/logo-ohlala-teal-gold-720@2x.png') }} 2x"
           alt="Oh La La Tours Bogot√°">
    </a>

    <nav class="main-nav" aria-label="{{ _('Navigation principale') }}">
      <a href="{{ url_for('index', lang=get_locale()) }}">{{ _("Accueil") }}</a>
      <a href="{{ url_for('tours', lang=get_locale()) }}">{{ _("Nos tours") }}</a>
      <a href="{{ url_for('transport', lang=get_locale()) }}">{{ _("Service de Transport") }}</a>
      <a href="{{ url_for('reservation', lang=get_locale()) }}">{{ _("R√©servation") }}</a>

      <div class="lang-switcher" aria-label="{{ _('Changer de langue') }}">
        <a href="{{ lang_url('fr') }}" lang="fr" aria-label="Fran√ßais">üá´üá∑<span class="sr-only">Fran√ßais</span></a>
        <a href="{{ lang_url('en') }}" lang="en" aria-label="English">üá∫üá∏<span class="sr-only">English</span></a>
        <a href="{{ lang_url('es') }}" lang="es" aria-label="Espa√±ol">üá™üá∏<span class="sr-only">Espa√±ol</span></a>
      </div>
    </nav>
  </header>

  <!-- Bandeau (ancienne topbar supprim√©e) -->
  <header class="hero background-half"
          style="background-image: url('{{ url_for('static', filename='images/bg_reservation.jpg') }}');"
          role="img"
          aria-label="{{ _('Panorama de Bogot√°, t√©l√©ph√©rique de Monserrate et rues coloniales de la Candelaria ; r√©servez vos visites priv√©es (Candelaria, Monserrate, Zipaquir√°, La Chorrera, finca caf√©) et transferts a√©roport. EN: Bogot√° skyline and Monserrate cable car; book private tours & airport transfer. ES: Bogot√° al atardecer con telef√©rico de Monserrate; reserva tours privados y traslado al aeropuerto') }}"
          title="{{ _('R√©servation de visites et transferts ‚Äî Oh La La Tours Bogot√°') }}"
          aria-describedby="hero-desc">
    <h1 class="hero-title">
      {{ _("R√©server votre visite") }}{% if tour %} : {{ _(tour.capitalize()) }}{% endif %}
    </h1>
    <!-- ‚úÖ Texte associ√© masqu√© -->
    <span id="hero-desc" class="sr-only">
      {{ _('Image : Bogot√°, Monserrate et La Candelaria. R√©servez ici vos visites priv√©es (Candelaria, Monserrate, Zipaquir√°, La Chorrera, finca caf√©) et vos transferts a√©roport avec guide francophone/anglais/espagnol.') }}
    </span>
  </header>

  <!-- Fil d‚ÄôAriane (accessibilit√© + SEO) -->
  <nav aria-label="{{ _('Fil d‚ÄôAriane') }}" style="max-width:1000px;margin:10px auto;padding:0 20px;font-size:.95rem;">
    <a href="{{ url_for('index', lang=get_locale()) }}">{{ _('Accueil') }}</a> ‚Ä∫
    <a href="{{ url_for('tours', lang=get_locale()) }}">{{ _('Nos tours') }}</a> ‚Ä∫
    <span aria-current="page">{{ _('R√©servation') }}</span>
  </nav>

  <!-- Formulaire -->
  <main>
    <section class="reservation-container">
      <form class="reservation-form" method="POST" action="{{ url_for('reservation', lang=get_locale()) }}" novalidate>
        {% if tour %}
          <!-- Conserv√© (m√™me si redondant avec le <select>) pour ne rien supprimer -->
          <input type="hidden" name="tour" value="{{ tour }}">
        {% endif %}

        <label for="nom">{{ _("Nom") }}</label>
        <input type="text" id="nom" name="nom" required autocomplete="name" inputmode="text">

        <label for="email">{{ _("Email") }}</label>
        <input type="email" id="email" name="email" required autocomplete="email" inputmode="email">

        <label for="date">{{ _("Date souhait√©e") }}</label>
        <input type="date" id="date" name="date" required>

        <label for="message">{{ _("Message") }}</label>
        <textarea id="message" name="message" rows="4" placeholder="{{ _('Infos utiles, horaires, etc.') }}"></textarea>

        <label for="tour">{{ _("Choisissez un tour") }}</label>
        <select name="tour" id="tour" required>
          <option value="">{{ _("-- S√©lectionnez --") }}</option>
          <option value="candelaria" {{ 'selected' if tour=='candelaria' else '' }}>{{ _("Visite historique de La Candelaria") }}</option>
          <option value="monserrate" {{ 'selected' if tour=='monserrate' else '' }}>{{ _("Randonn√©e √† Monserrate") }}</option>
          <option value="zipaquira"  {{ 'selected' if tour=='zipaquira'  else '' }}>{{ _("Excursion √† la Cath√©drale de sel de Zipaquir√°") }}</option>
          <option value="chorrera"   {{ 'selected' if tour=='chorrera'   else '' }}>{{ _("Cascade de La Chorrera") }}</option>
          <option value="finca-cafe" {{ 'selected' if tour=='finca-cafe' else '' }}>{{ _("Visite d‚Äôune finca √† caf√©") }}</option>
        </select>

        <!-- Mode de paiement (pour l‚Äôavenir) -->
        <label for="payment-method">{{ _("Mode de paiement") }}</label>
        <select id="payment-method" name="payment-method" aria-label="{{ _('Mode de paiement') }}">
          <option value="paypal" selected>PayPal</option>
        </select>

        <!-- Bloc PayPal -->
        <div id="paypal-section" style="margin-top:12px;">
          <label for="paypal-email">{{ _("Email PayPal") }}</label>
          <input type="email" id="paypal-email" name="paypal-email" placeholder="{{ _('optionnel') }}" autocomplete="email" inputmode="email">

          <small style="display:block;margin-top:6px;">
            {{ _("Pas de compte PayPal ? Choisissez l‚Äôoption carte bancaire sur l‚Äô√©cran PayPal.") }}
          </small>

          <!-- Bouton PayPal s‚Äôaffiche ici -->
          <div id="paypal-button-container" style="margin-top:12px;"></div>
          <!-- Bouton CARTE s‚Äôaffiche ici (ajout) -->
          <div id="card-button-container" style="margin-top:12px;"></div>

          <!-- Zone d‚Äôerreur visible si SDK non charg√© -->
          <div id="paypal-error" role="alert" style="display:none;margin-top:10px;padding:10px;border:1px solid #f00;color:#b00;background:#fee;"></div>

          <noscript>
            <p style="margin-top:8px;color:#b00;background:#fff4f4;border:1px solid #f3c2c2;padding:8px;">
              {{ _("Le paiement PayPal n√©cessite JavaScript. Activez JavaScript ou contactez-nous par email/WhatsApp pour r√©server.") }}
            </p>
          </noscript>
        </div>

        <button type="submit" id="form-submit">{{ _("Envoyer") }}</button>
      </form>
    </section>
  </main>

  <!-- SDK PayPal ‚Äì LIVE/SANDBOX selon ton client-id -->
  <!-- Autorise √† la fois wallet PayPal et carte (locale adapt√©e) -->
  <script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=EUR&intent=capture&components=buttons&enable-funding=card,credit,paylater&locale={% if get_locale()=='fr' %}fr_FR{% elif get_locale()=='en' %}en_US{% else %}es_ES{% endif %}"></script>

  <!-- Int√©gration PayPal -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Pr√©selectionne le tour si fourni en querystring (?tour=‚Ä¶)
      (function preselectTourFromQuery() {
        const urlParams = new URLSearchParams(window.location.search);
        const t = urlParams.get('tour');
        if (t) {
          const select = document.getElementById('tour');
          if (select && [...select.options].some(o => o.value === t)) {
            select.value = t;
          }
        }
      })();

      // Prix par tour (√† adapter)
      const prices = {
        candelaria: 1,
        monserrate: 1,
        zipaquira: 1,
        chorrera: 1,
        'finca-cafe': 50
      };

      // Emp√™che d‚Äôenvoyer le formulaire quand PayPal est choisi
      const form = document.querySelector('.reservation-form');
      const methodSelect = document.getElementById('payment-method');
      form.addEventListener('submit', function (e) {
        if (methodSelect.value === 'paypal') {
          e.preventDefault();
          document.getElementById('paypal-section').scrollIntoView({ behavior: 'smooth', block: 'center' });
          alert("{{ _('Pour payer avec PayPal, cliquez sur le bouton PayPal au-dessus de ¬´ Envoyer ¬ª.') }}");
        }
      });

      // Rendu unique du bouton Wallet
      let paypalRendered = false;

      function renderPaypalButton() {
        if (paypalRendered) return;
        const errBox = document.getElementById('paypal-error');

        if (!window.paypal) {
          errBox.style.display = 'block';
          errBox.textContent = "{{ _('PayPal ne s‚Äôest pas charg√©. V√©rifiez votre Client ID et d√©sactivez les bloqueurs.') }}";
          return;
        }

        // --- Bouton PayPal (wallet) ---
        paypal.Buttons({
          fundingSource: paypal.FUNDING.PAYPAL,

          createOrder: function (data, actions) {
            const tourId = document.getElementById('tour').value || '';
            const amount = (prices[tourId] || 40).toFixed(2);
            const date = document.getElementById('date').value || '';
            const nom  = document.getElementById('nom').value || '';

            const description = `Tour: ${tourId || 'N/A'} | Date: ${date || 'N/A'} | Nom: ${nom || 'N/A'}`;

            return actions.order.create({
              purchase_units: [{
                amount: { currency_code: 'EUR', value: amount },
                description
              }]
            });
          },

          onApprove: function (data, actions) {
            return actions.order.capture().then(function () {
              window.location.href = '/paiement-reussi?orderID=' + data.orderID + '&lang={{ get_locale() }}';
            });
          },

          onCancel: function () {
            window.location.href = '/paiement-annule?lang={{ get_locale() }}';
          },

          onError: function (err) {
            const errBox = document.getElementById('paypal-error');
            errBox.style.display = 'block';
            errBox.textContent = 'PayPal: ' + (err && err.message ? err.message : err);
            console.error('PayPal error:', err);
          }
        })
        .render('#paypal-button-container')
        .then(function () { paypalRendered = true; });

        // --- Bouton Carte via PayPal (en plus du wallet) ---
        (function renderCardButton() {
          const cardBtn = paypal.Buttons({
            fundingSource: paypal.FUNDING.CARD,
            style: { layout: 'vertical', color: 'blue', shape: 'rect', label: 'pay' },

            createOrder: function (data, actions) {
              const tourId = document.getElementById('tour').value || '';
              const amount = (prices[tourId] || 40).toFixed(2);
              const date = document.getElementById('date').value || '';
              const nom  = document.getElementById('nom').value || '';
              const description = `Tour: ${tourId || 'N/A'} | Date: ${date || 'N/A'} | Nom: ${nom || 'N/A'}`;

              return actions.order.create({
                purchase_units: [{
                  amount: { currency_code: 'EUR', value: amount },
                  description
                }]
              });
            },

            onApprove: function (data, actions) {
              return actions.order.capture().then(function () {
                window.location.href = '/paiement-reussi?orderID=' + data.orderID + '&lang={{ get_locale() }}';
              });
            },

            onCancel: function () {
              window.location.href = '/paiement-annule?lang={{ get_locale() }}';
            },

            onError: function (err) {
              const errBox = document.getElementById('paypal-error');
              errBox.style.display = 'block';
              errBox.textContent = 'PayPal (carte): ' + (err && err.message ? err.message : err);
              console.error('PayPal card error:', err);
            }
          });

          if (cardBtn.isEligible()) {
            cardBtn.render('#card-button-container');
          }
        })();
      }

      // Rendre les boutons imm√©diatement
      renderPaypalButton();
    });
  </script>

  <!-- ‚úÖ Donn√©es structur√©es : Service + Breadcrumb -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Service",
    "name":"R√©servation de visites guid√©es √† Bogot√°",
    "provider":{
      "@type":"LocalBusiness",
      "name":"Oh La La Tours Bogot√°",
      "areaServed":"Bogot√°, Colombia",
      "url":"https://www.ohlalatoursbogota.com/",
      "availableLanguage":["French","Spanish","English"]
    },
    "serviceType":"Visites guid√©es priv√©es et excursions",
    "areaServed":"Bogot√°, Colombia",
    "offers":{
      "@type":"AggregateOffer",
      "priceCurrency":"EUR",
      "lowPrice":"15.00",
      "highPrice":"55.00",
      "availability":"https://schema.org/InStock",
      "url":"https://www.ohlalatoursbogota.com{{ request.path }}"
    }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {
        "@type":"ListItem",
        "position":1,
        "name":"{{ _('Accueil') }}",
        "item":"{{ url_for('index', lang=get_locale(), _external=True) }}"
      },
      {
        "@type":"ListItem",
        "position":2,
        "name":"{{ _('Nos tours') }}",
        "item":"{{ url_for('tours', lang=get_locale(), _external=True) }}"
      },
      {
        "@type":"ListItem",
        "position":3,
        "name":"{{ _('R√©servation') }}",
        "item":"{{ url_for('reservation', lang=get_locale(), _external=True) }}"
      }
    ]
  }
  </script>

  <!-- ‚úÖ Script AJOUT√â : toggle du header au scroll -->
  <script>
    (function(){
      const header = document.querySelector('.site-header');
      if(!header) return;
      function onScroll(){ header.classList.toggle('scrolled', window.scrollY > 60); }
      onScroll();
      window.addEventListener('scroll', onScroll, {passive:true});
    })();
  </script>

</body>
</html>


